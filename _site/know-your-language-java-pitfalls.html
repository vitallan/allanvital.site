<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Know Your Language: Java Pitfalls &middot; Allan Vital
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Allan Vital
      </a>
    </div>
    <p class="lead">Software Development and overall Problem Solving. <a href="/about" target="_blank">More about me</a>.</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  

  
    
      <a class="page-link "
          href="/about/">About</a>
    
  

  
    
  

  

  

  
    
  


  


  

  
    
  

  
    
  

  

  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  

  <nav id="sidebar-icon-links">
  
  <a id="linkedin-link"
     class="icon" title="Linkedin Profile" aria-label="Linkedin Profile"
     href="https://www.linkedin.com/in/allanvital/">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"/></svg>
  </a>

  <a id="stackoverflow-link"
     class="icon" title="Stackoverflow Profile" aria-label="Stackoverflow Profile"
     href="https://stackoverflow.com/users/3632899/allan-vital">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M15 21h-10v-2h10v2zm6-11.665l-1.621-9.335-1.993.346 1.62 9.335 1.994-.346zm-5.964 6.937l-9.746-.975-.186 2.016 9.755.879.177-1.92zm.538-2.587l-9.276-2.608-.526 1.954 9.306 2.5.496-1.846zm1.204-2.413l-8.297-4.864-1.029 1.743 8.298 4.865 1.028-1.744zm1.866-1.467l-5.339-7.829-1.672 1.14 5.339 7.829 1.672-1.14zm-2.644 4.195v8h-12v-8h-2v10h16v-10h-2z"/></svg>
  </a>

  <a id="github-link"
     class="icon" title="Github Profile" aria-label="Github Profile"
     href="https://github.com/vitallan">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28" height="24" width="28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

  </a>

  <a id="twitter-link"
     class="icon" title="Twitter Profile" aria-label="Twitter Profile"
     href="https://twitter.com/allanvital">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/></svg>
  </a>

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

</nav>
  <p>
  &copy; 2019.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Know Your Language: Java Pitfalls</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">28 Sep 2017</span>
  <span class="post-categories">
    
  </span>
</div>


  <div class="post-body">
    <p><em>Let’s get more technical. ‘Know your Language’ is a new category in my blog, about Programming Languages and their most common problems in enterprise environments</em></p>

<p>According to <a href="https://www.tiobe.com/tiobe-index/">Tiobe</a> Java is the most used backend programming language of the world. According to <a href="https://insights.stackoverflow.com/survey/2017#technology">StackOverflow</a>, this title goes to Javascript, but Java gets third place. Java and the JVM are also almost omnipresent in mobile, with Android using it as a platform.</p>

<p>It is adopted by major companies and there are a lot of job openings for it. Also, you can always find some tool or framework that solves that particular problem you are facing, given it’s huge history and fame.</p>

<p>It is also extremely verbose, prone to code bloat, low level (compared with newer languages), clunky all around and resource-eating.</p>

<p>I know that all boils down to “there are bad programs in all languages”, but I believe that there are design details of each language that puts developers in a easy position to fall down in some traps, specially considering that we usually tend to “follow the guidelines” of the gurus.</p>

<p>Sticking to code and design, let’s see what are the most common pitfalls I’ve seen in Java projects.</p>

<h4 id="complex-build">Complex Build</h4>
<p>Pretty simple. You do your clone, access the directory and do a build command</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./gradlew build
</code></pre></div></div>
<p>And then it fails.</p>

<p>Usually this means an environment dependency or a manually added hosts to run the build or tests. Unless your build actually runs in a single command, you are doing it wrong.</p>

<p>Gradle is a specially offender in this case because of the easiness to create customized tasks. Avoid overly <em>romantic</em> tasks and approaches, like code generation.</p>

<h4 id="thrown-design-patterns">Thrown Design Patterns</h4>

<p>The idea behind a design pattern is somewhat simple: You have a recurrent problem and a design pattern is a known way to solve that problem. Pretty straightforward, Problem leads to Solution. The issues arise when you like one solution and tends to apply it anywhere you see fit (the old <a href="https://en.wikipedia.org/wiki/Law_of_the_instrument">“when all you have is a hammer, everything looks like a nail”</a>).</p>

<p>Simple example, a Strategy Pattern. In cool words Strategy is a way that enables algorithm selecting at runtime. In common terms, it is used to hide an “if” statement.</p>

<p><strong><a href="https://en.wikipedia.org/wiki/Strategy_pattern">Wikipedia example:</a></strong></p>

<p>Interface with price calculation</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interface BillingStrategy {
    double getActPrice(final double rawPrice);
}
</code></pre></div></div>

<p>First implementation</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class NormalStrategy implements BillingStrategy {
    @Override
    public double getActPrice(final double rawPrice) {
        return rawPrice;
    }
}
</code></pre></div></div>

<p>Second implementation</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class HappyHourStrategy implements BillingStrategy {

    @Override
    public double getActPrice(final double rawPrice) {
        return rawPrice*0.5;
    }

}
</code></pre></div></div>

<p>We could have our customer class:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Customer {
    /* fields */
    public Customer(final BillingStrategy strategy) {
        this.drinks = new ArrayList&lt;Double&gt;();
        this.strategy = strategy;
    }

    public void add(final double price, final int quantity) {
      drinks.add(strategy.getActPrice(price*quantity));
    }

    public void setStrategy(final BillingStrategy strategy) {
        this.strategy = strategy;
    }

}

</code></pre></div></div>
<p>And now we can use it neatly:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class StrategyPatternWiki {

    public static void main(final String[] arguments) {
        Customer firstCustomer = new Customer(new NormalStrategy());

        // Normal billing
        firstCustomer.add(1.0, 1);

        // Start Happy Hour
        firstCustomer.setStrategy(new HappyHourStrategy());
        firstCustomer.add(1.0, 2);
    }
}
</code></pre></div></div>

<p>Cool right? How can it be bad? Let’s apply this everywhere!</p>

<p>But there is a catch, even in this simple example. How do I know when to use HappyHourStrategy or NormalStrategy? Can I hide this specific if with another strategy? If yes, would it be better than a single if? Maybe, instead of this, I could add in the customer class:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Customer {
...
    public void add(final double price, final int quantity) {
        drinks.add(floatingPriceCalculator.getCurrentPrice(price*quantity));
    }
...
}
</code></pre></div></div>
<p>And then</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class FloatingPriceCalculator {
    public double getCurrentPrice(final double rawPrice) {
        if (isHappyHourTime()){
           return rawPrice * 0.5;
        } else {
           return rawPrice;
        }
    }
}
</code></pre></div></div>

<p>Is it so bad? You’re making the decision in a single IF-ELSE instead of building an indirection layer, and besides it, still in a single point, in case you need to refactor or read it. If this if else grow in number, maybe it is time to refactor, but right now, I think it is good enough.</p>

<p>Design patterns are tools, not the only way to do something.</p>

<h4 id="functional-interface-misuse">Functional Interface Misuse</h4>

<p>Functional interfaces are awesome. It can really make your code more elegant and simple. Let’s take a look, using <a href="https://www.oreilly.com/learning/java-8-functional-interfaces">OReilly</a> as a resource.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@FunctionalInterface
public interface Runnable {
  public void run();
}
</code></pre></div></div>

<p>In the old days, we would use it like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Thread thread1 = new Thread(new Runnable() {
    @Override
    public void run(){
        System.out.println("Run now!");
    }
});
</code></pre></div></div>
<p>With Java8 and Lambdas, the compiler knows that you are calling the single method from the functional interface.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Runnable task1 = () -&gt; { System.out.println("run you damn!"); };
new Thread(task1).start();
</code></pre></div></div>

<p>Neat, right? The “()” syntax is useful because you can just pass the arguments there and the compiler knows the types.</p>

<p>The problems arise when you try to build a DSL for fluent language with this, because nowadays you see things like:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maClass.needDoThis()
       .AndThis()
       .withALittleBitOfThis()
       .andNowDone();
</code></pre></div></div>
<p>And to build this, you create a single functional interface for each of the dots, like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public interface AndThis {
    LittleBitOfThis andThis();
}
public interface LittleBitOfThis {
    AndThis withALittleBitOfThis();
}
public interface NowDone {
    void andNowDone();
}
</code></pre></div></div>
<p>And in maClass.needDoThis() you get:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class MaClass{
    public void needDoThis() {
        () -&gt; () -&gt; () -&gt; {
           //do a lot of things
        }
    }
}
</code></pre></div></div>
<p>I’ve seen it more than once. Don’t do this. You created a lot of complication just to make a pretty oneliner, which, in the end, is just a single method anyway. Wouldn’t be easier if you just called the method?</p>

<h4 id="poor-or-overused-oo">Poor (or overused) OO</h4>

<p>I know that this is possible in any OO language, but Java suffers it hard. There’s a lot of confusion about concepts like composition over inheritance, or loose coupled parts or plain simple class design, and big problems arise from this confusion.</p>

<p>(Java8 default methods in interfaces made this even more common)</p>

<p>A great smell of bad class design is the <code class="highlighter-rouge">instanceof</code> operator used a lot. It, of course, has its uses, but always think through when you use it to check if your design is OO adherent.</p>

<p>A bad example from <a href="https://stackoverflow.com/a/13292073/3632899">StackOverflow</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Cage {
  public static Cage createCage(Animal animal) {
    if (animal instanceof Dog)
      return new DogHouse();
    else if (animal instanceof Lion)
      return new SteelCage();
    else if (animal instanceof Chicken)
      return new ChickenWiredCage();
    else if (animal instanceof AlienPreditor)
      return new ForceFieldCage();
    else
      return new GenericCage();
  }
}
</code></pre></div></div>
<p>You could replace and put the responsibility inside the Animal interface:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interface Animal {
  Cage getCage();
}

class Dog implements Animal {
  ...
  public Cage getCage() {
    return new DogCage();
  }
  ...
}
</code></pre></div></div>

<p>(I know, it’s just an academic example, but you got the idea)</p>

<p>In the other side of the spectrum, <a href="https://blog.codinghorror.com/your-code-oop-or-poo/">there’s the overly complex class design</a>, which should also be avoided.</p>

<h4 id="reflection">Reflection</h4>
<p>Reflection is one of the most powerful features of Java. You can, basically, access anything at runtime, even modify the methods or fields. The majority of frameworks use it to be able to call your code using the conventions of the language (getters and setters. How do you think hibernate fills your fields?).</p>

<p>Again, the problem with it is the layer of abstraction that you put in your code. When you use reflection, your errors will be in runtime, and your IDE will not be able to help you with the “find usages”. You are basically on your own.</p>

<p>As a rule of thumb, use Reflection to build frameworks, <a href="https://www.quora.com/Whats-the-difference-between-a-library-and-a-framework/answer/Kurt-Guntheroth-1?srid=oiBW">because they need to be able to call yet nonexistent code</a>. To build your applications, avoid it always.</p>

<p><a href="https://examples.javacodegeeks.com/core-java/reflection/java-reflection-example/">There are some examples here, and you can see why it is so bad.</a></p>

<h4 id="aspect-overuse">Aspect Overuse</h4>

<p>I think that this one is the most “personal” problem, because I see a lot of people praising AOP and the benefits of AspectJ, but I find myself enjoying it less and less as time passes. Right now I wouldn’t use it in application code, but, as it is with reflection, it is useful for framework creation.</p>

<p>One of the main reasons why I think it is harmful is for debugging. You came across a legacy system with a bug and you catch a glimpse of the log:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-05-25 00:22:31.496  INFO 1 --- [Thread-3] maProject.maPackage.maClass1 : Trying to do something
2017-05-25 00:22:31.512  INFO 1 --- [Thread-2] maProject.maPackage.maClass2 : I shoudn't be trying this, but I am nonetheless
2017-05-25 00:22:31.530  INFO 1 --- [Thread-3] maProject.maPackage.maClass3 : Continuing ok, nothing to see here
</code></pre></div></div>

<p>Cool, maClass2 seems to be the aggressor. Then you open the class and don’t find the log line. And don’t see where maClass1 is calling maClass2. And neither the call to maClass1. Everything is build around aspects, and your whole project is a huge collection of indirection layers, one after another.</p>

<p>Avoid it. It is not harmful to see a <code class="highlighter-rouge">log.info("")</code> inside your method.</p>

<p>Sometimes it is better to be straightforward than clever.</p>

<h4 id="ejb-2">EJB 2</h4>

<p>Just don’t. I mean it.</p>

    



<div class="post-tags">
  
    <span>
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">know-your-language</span>
    </span>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    <p>I feel that comments on specific blogs have been dying down as the times goes. If you have any questions or want to talk about the post, contact me at <a href="mailto:allan.vital@gmail.com">allan.vital@gmail.com</a> or <a href="https://twitter.com/allanvital">@allanvital .</a></p>
  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/5-reasons-why-you-should-not-rewrite-your-system">
            5 Reasons Why You Should NOT Rewrite Your System
            <small>21 Jan 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/what-defines-a-good-software-developer">
            What defines a good Software Developer?
            <small>06 Sep 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/why-estimates-never-work">
            About Software Estimates
            <small>22 Jul 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
