<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Leader Election Using Spring-Boot &middot; Allan Vital
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Allan Vital
      </a>
    </div>
    <p class="lead">Software Development and overall Problem Solving. <a href="/about" target="_blank">More about me</a>.</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  

  
    
      <a class="page-link "
          href="/about/">About</a>
    
  

  
    
  

  

  

  
    
  


  


  

  
    
  

  
    
  

  

  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  

  <nav id="sidebar-icon-links">
  
  <a id="linkedin-link"
     class="icon" title="Linkedin Profile" aria-label="Linkedin Profile"
     href="https://www.linkedin.com/in/allanvital/">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"/></svg>
  </a>

  <a id="stackoverflow-link"
     class="icon" title="Stackoverflow Profile" aria-label="Stackoverflow Profile"
     href="https://stackoverflow.com/users/3632899/allan-vital">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M15 21h-10v-2h10v2zm6-11.665l-1.621-9.335-1.993.346 1.62 9.335 1.994-.346zm-5.964 6.937l-9.746-.975-.186 2.016 9.755.879.177-1.92zm.538-2.587l-9.276-2.608-.526 1.954 9.306 2.5.496-1.846zm1.204-2.413l-8.297-4.864-1.029 1.743 8.298 4.865 1.028-1.744zm1.866-1.467l-5.339-7.829-1.672 1.14 5.339 7.829 1.672-1.14zm-2.644 4.195v8h-12v-8h-2v10h16v-10h-2z"/></svg>
  </a>

  <a id="github-link"
     class="icon" title="Github Profile" aria-label="Github Profile"
     href="https://github.com/vitallan">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28" height="24" width="28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

  </a>

  <a id="twitter-link"
     class="icon" title="Twitter Profile" aria-label="Twitter Profile"
     href="https://twitter.com/allanvital">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/></svg>
  </a>

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

</nav>
  <p>
  &copy; 2019.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Leader Election Using Spring-Boot</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">08 Nov 2016</span>
  <span class="post-categories">
    
  </span>
</div>


  <div class="post-body">
    <p>Warning: technical post ahead. You may want to take the children out of the room!</p>

<p>Spring-boot took the market by storm in the last years. Spring, as is, <a href="http://www.indeed.com/jobtrends/q-Spring-Framework-q--J2EE-q--Java-EE-q--Java.html?relative=1">with MVC dependency had already bitten a huge chunk of job posts and online questions</a>, but with the Boot simplicity, it practically set the new standart for frameworks in Java language. With it’s auto-configuration features and <a href="https://start.spring.io/">spring initiatizr</a> , projects setup now takes seconds.</p>

<p>But all simplicity comes with a price: It’s hard to do some simple customized thing outside the framework. Maybe not hard, but when you become accustomed with blindly easy property setting, all complication gets frustrating. That’s how it began my small quest.</p>

<p>I was testing some features for a new project at work and one of the many ideas was to, given a number of spring nodes, without intervention, set one node as a leader to run a background job. Simple as that. It’s called <a href="https://en.wikipedia.org/wiki/Leader_election">Cluster Leadership Election</a>, and it’s a commom problem in many clusterized environments (<a href="http://redis.io/topics/sentinel">Redis</a> among others).</p>

<p>Spring philosophy is to keep your server stateless, therefore there’s no need for election process, since the n nodes of your application are not exactly clusterized, in the way that they are not aware of each other. It’s great for horizontal scalling, and I believe it’s one of the “spring ways of life” wich brought it to the top. But in my case, all I wanted was a simple way to keep the nodes aware if they are or not the leader.</p>

<p>Searching the documentation, I’ve first come across <a href="https://github.com/spring-cloud/spring-cloud-cluster/tree/master/spring-cloud-cluster-hazelcast">Leadership Election with Hazelcast Spring Cloud Cluster</a>, but oops, it’s Deprecated in favour of <a href="https://projects.spring.io/spring-integration/">Spring-Integration</a>. I started looking at this one instead, but it was an immense overkill for my use case. I didn’t need complex interations between my nodes, neither needed grand integrations between many different protocols. Dead end.</p>

<p>The other way I’ve found was to use <a href="https://zookeeper.apache.org/">ZooKeeper</a>. It is an awesome project, which has by default the <a href="https://zookeeper.apache.org/doc/trunk/recipes.html#sc_leaderElection">Leadership Election</a> that I so much needed. But, again, setting up a ZooKeeper cluster seemed a big step to execute something simple. I didn’t need service discovery and the many more features it brings to the table. Seemed like a cannon to kill an ant. Discarded.</p>

<p>Besides these two I found… nothing. It was really difficult finding someone with the same problem, and, when I found, they usually built something big and complex, with database tables and the sort. Not the idea of quick and simple that I had in mind.</p>

<p>So, <a href="https://github.com/vitallan/redis-leader-by-lock">I built one myself</a>.</p>

<p>Using redis set to create a lock registry, the idea is: Whoever holds the lock, is the leader. This is somewhat different from other implementation where the oldest node is the leader until shutdown, because the leadership can go from node to node depending on the lock ping and the lock timout, but scratched my itch. It is simple, with easy configuration, reliable and expandable.</p>

<p><a href="https://github.com/vitallan/redis-leader-by-lock">Feel free to use it</a>.</p>

<p>It’s nice to test it in, say, four different terminals. That way you can kill and spawn the proccess and check it’s own organization to define the leader and change it. One improvement would be to randomize the fixed delays and check the behaviour. I will do this test in a near future.</p>

<p>Please, oh please, if you find any bug or problem, <a href="https://github.com/vitallan/redis-leader-by-lock/issues">let me know</a>.</p>

    



<div class="post-tags">
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    <p>I feel that comments on specific blogs have been dying down as the times goes. If you have any questions or want to talk about the post, contact me at <a href="mailto:allan.vital@gmail.com">allan.vital@gmail.com</a> or <a href="https://twitter.com/allanvital">@allanvital .</a></p>
  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/5-reasons-why-you-should-not-rewrite-your-system">
            5 Reasons Why You Should NOT Rewrite Your System
            <small>21 Jan 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/know-your-language-java-pitfalls">
            Know Your Language: Java Pitfalls
            <small>28 Sep 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/what-defines-a-good-software-developer">
            What defines a good Software Developer?
            <small>06 Sep 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
